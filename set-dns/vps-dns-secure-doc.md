# vps-dns-secure.sh ‚Äì –°–∫—Ä–∏–ø—Ç –∑–∞ –ø–æ–¥—Å–∏–ª–≤–∞–Ω–µ –Ω–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ DNS —Å—ä—Ä–≤—ä—Ä–∏ (Bind9)

## üìå –í—ä–≤–µ–¥–µ–Ω–∏–µ
`vps-dns-secure.sh` –µ —Å–∫—Ä–∏–ø—Ç –∑–∞ –ø—Ä–∏–ª–∞–≥–∞–Ω–µ –Ω–∞ **–º–µ—Ä–∫–∏ –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç –≤—ä—Ä—Ö—É –≤–µ—á–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω DNS —Å—ä—Ä–≤—ä—Ä (Bind9)**.  
–°—ä–∑–¥–∞–¥–µ–Ω –µ –¥–∞ —Ä–∞–±–æ—Ç–∏ —Å–ª–µ–¥ —É—Å–ø–µ—à–Ω–æ—Ç–æ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –Ω–∞ `vps-dns-qsetup.sh` –∏ –∏–º–∞ –∑–∞ —Ü–µ–ª:

- –ü–æ–¥—Å–∏–ª–≤–∞–Ω–µ –Ω–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ DNS –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞.
- –û–≥—Ä–∞–Ω–∏—á–∞–≤–∞–Ω–µ –Ω–∞ –¥–æ—Å—Ç—ä–ø–∞ –¥–æ –∑–æ–Ω–∏—Ç–µ —á—Ä–µ–∑ ACL –∏ TSIG.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ `named.conf.options`.
- –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∏ –∫–æ–ø–∏—è –ø—Ä–µ–¥–∏ –ø—Ä–æ–º–µ–Ω–∏.
- –¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º.

---

## ‚úÖ –û—Å–Ω–æ–≤–Ω–∏ —Ü–µ–ª–∏
- –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ **TSIG –∫–ª—é—á–æ–≤–µ** –∑–∞ –∑–∞—â–∏—Ç–∞ –ø—Ä–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –Ω–∞ –∑–æ–Ω–∏.
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ **ACL (Access Control Lists)** –∑–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏ IP.
- –ü–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ, —á–µ `recursion no;` –µ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω.
- –û–≥—Ä–∞–Ω–∏—á–∞–≤–∞–Ω–µ –Ω–∞ `allow-transfer` –∏ `allow-notify` –¥–æ –¥–æ–≤–µ—Ä–µ–Ω–∏ IP.
- –¢–µ—Å—Ç –∑–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç –Ω–∞ –∑–æ–Ω–∏—Ç–µ —Å–ª–µ–¥ –ø—Ä–æ–º–µ–Ω–∏.
- –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ–¥—Ä–æ–±–µ–Ω —Ñ–∏–Ω–∞–ª–µ–Ω –æ—Ç—á–µ—Ç.

---

## üì• –ö–∞–∫ –¥–∞ –∏–∑—Ç–µ–≥–ª–∏—Ç–µ –∏ —Å—Ç–∞—Ä—Ç–∏—Ä–∞—Ç–µ —Å–∫—Ä–∏–ø—Ç–∞
–°–∫—Ä–∏–ø—Ç—ä—Ç —Å–µ –Ω–∞–º–∏—Ä–∞ –≤ **—á–∞—Å—Ç–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** –≤ GitHub –∏ –∏–∑–∏—Å–∫–≤–∞ —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞ –∑–∞ —á–µ—Ç–µ–Ω–µ:

```bash
# 1. –ò–∑—Ç–µ–≥–ª—è–Ω–µ –Ω–∞ —Å–∫—Ä–∏–ø—Ç–∞ —Å GitHub —Ç–æ–∫–µ–Ω
curl -H "Authorization: token <–í–ê–®–ò–Ø_–¢–û–ö–ï–ù>" \
     -fsSL https://raw.githubusercontent.com/NetGalaxySoft/servers/main/set-dns/vps-dns-secure.sh \
     -o vps-dns-secure.sh

# 2. –î–∞–≤–∞–Ω–µ –Ω–∞ –ø—Ä–∞–≤–∞ –∑–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ
chmod +x vps-dns-secure.sh

# 3. –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Å–∫—Ä–∏–ø—Ç–∞
./vps-dns-secure.sh
```

> üîê **–ë–µ–ª–µ–∂–∫–∞:** –ù–∏–∫–æ–≥–∞ –Ω–µ —Å–ø–æ–¥–µ–ª—è–π—Ç–µ —Å–≤–æ—è GitHub —Ç–æ–∫–µ–Ω –ø—É–±–ª–∏—á–Ω–æ.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –º–æ–¥—É–ª–∏ –≤ `vps-dns-secure.sh`

---

### **–ú–æ–¥—É–ª 1: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª–Ω–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏**
- –ü—Ä–æ–≤–µ—Ä—è–≤–∞:
  - –î–∞–ª–∏ —Å–∫—Ä–∏–ø—Ç—ä—Ç `vps-dns-qsetup.sh` –µ –∏–∑–ø—ä–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ (`SETUP_VPS_DNS_STATUS=‚úÖ`).
  - –î–∞–ª–∏ Bind9 —Ä–∞–±–æ—Ç–∏.
- –í–∞–ª–∏–¥–∏—Ä–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞ —Å `named-checkconf`.
- –°—ä–∑–¥–∞–≤–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∏ –∫–æ–ø–∏—è –Ω–∞:
  - `/etc/bind/named.conf.options`
  - `/etc/bind/named.conf.local`

---

### **–ú–æ–¥—É–ª 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–∞–∑–æ–≤–∏—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏**
- –ü–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞, —á–µ:
  - `recursion no;` –µ –∞–∫—Ç–∏–≤–µ–Ω.
  - `allow-query` –µ –∑–∞–¥–∞–¥–µ–Ω –ø—Ä–∞–≤–∏–ª–Ω–æ (–ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ `{ any; }`).
- –ê–∫–æ –ª–∏–ø—Å–≤–∞ –∏–ª–∏ –µ –≥—Ä–µ—à–Ω–æ ‚Üí –∫–æ—Ä–∏–≥–∏—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

---

### **–ú–æ–¥—É–ª 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ ACL**
- –°—ä–∑–¥–∞–≤–∞ ACL –±–ª–æ–∫:
  ```text
  acl "trusted" { SERVER_IP; SECOND_DNS_IP; };
  ```
- –î–æ–±–∞–≤—è –ø—Ä–∞–≤–∏–ª–∞:
  ```text
  allow-transfer { key "tsig-key"; };
  allow-notify { key "tsig-key"; };
  ```
- –û–≥—Ä–∞–Ω–∏—á–∞–≤–∞–Ω–µ –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∏—Ç–µ —Å–∞–º–æ –∑–∞ –¥–æ–≤–µ—Ä–µ–Ω–∏ IP –∏ –∫–ª—é—á–æ–≤–µ.

---

### **–ú–æ–¥—É–ª 4: –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ TSIG –∫–ª—é—á**
- –ì–µ–Ω–µ—Ä–∏—Ä–∞ –∫–ª—é—á —Å:
  ```bash
  tsig-keygen -a hmac-sha256 tsig-key
  ```
- –ó–∞–ø–∏—Å–≤–∞ –∫–ª—é—á–∞ –≤ `/etc/bind/keys/tsig.key`.
- –î–æ–±–∞–≤—è –∫–ª—é—á–∞ –≤ `named.conf.local` –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞ –Ω–∞ –∑–æ–Ω–∏—Ç–µ:
  - `server SECOND_DNS_IP { keys "tsig-key"; };`
  - `also-notify { SECOND_DNS_IP; };`

---

### **–ú–æ–¥—É–ª 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ä–µ—Å—Ç–∞—Ä—Ç**
- –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞ —Å `named-checkconf`.
- –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞ —É—Å–ª—É–≥–∞—Ç–∞ `bind9`.
- –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –¥–∞–ª–∏ —Ä–∞–±–æ—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ.

---

### **–ú–æ–¥—É–ª 6: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω —Ç–µ—Å—Ç –∑–∞ TSIG**
- –ò–∑–ø–æ–ª–∑–≤–∞ `dig` –∑–∞ –¥–∞ –ø—Ä–æ–≤–µ—Ä–∏ —É—Å–ø–µ—à–µ–Ω —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä —Å—ä—Å –∑–∞–¥–∞–¥–µ–Ω–∏—è –∫–ª—é—á:
  ```bash
  dig @SECOND_DNS_IP DOMAIN AXFR -y tsig-key:—Å–µ–∫—Ä–µ—Ç–µ–Ω_–∫–ª—é—á
  ```
- –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –ª–æ–≥–æ–≤–µ—Ç–µ –∑–∞ –≥—Ä–µ—à–∫–∏.

---

### **–ú–æ–¥—É–ª 7: –§–∏–Ω–∞–ª–µ–Ω –æ—Ç—á–µ—Ç**
- –ü–æ–∫–∞–∑–≤–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –≤—Å–∏—á–∫–∏ –º–æ–¥—É–ª–∏.
- –ü–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –Ω–∞–ª–∏—á–∏–µ—Ç–æ –Ω–∞:
  - TSIG –∫–ª—é—á.
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏ ACL.
- –ò–∑–∏—Å–∫–≤–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.
- –ò–∑—Ç—Ä–∏–≤–∞ –≤—Ä–µ–º–µ–Ω–Ω–∏—Ç–µ —Ñ–∞–π–ª–æ–≤–µ –∏ (–ø–æ –∏–∑–±–æ—Ä) —Å–∫—Ä–∏–ø—Ç–∞.

---

## ‚úÖ –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –º–µ—Ä–∫–∏ (–ø–ª–∞–Ω–∏—Ä–∞–Ω–∏)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å **fail2ban** –∑–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç brute-force.
- –õ–∏–º–∏—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —á–µ—Å—Ç–æ—Ç–∞ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ (rate limiting).
- –í–æ–¥–µ–Ω–µ –Ω–∞ **audit log** –∑–∞ –≤—Å–∏—á–∫–∏ –ø—Ä–æ–º–µ–Ω–∏.

---

## üîç –ü—Ä–µ–¥–∏–º—Å—Ç–≤–∞ –Ω–∞ –ø–æ–¥—Ö–æ–¥–∞
- –ò–∑—Ü—è–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω–∏ —Å—Ç—ä–ø–∫–∏ –±–µ–∑ –Ω—É–∂–¥–∞ –æ—Ç —Ä—ä—á–Ω–∞ –Ω–∞–º–µ—Å–∞.
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞ —Å—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç —Å –ø—Ä–µ–¥–∏—à–Ω–∏—è —Å–∫—Ä–∏–ø—Ç (`vps-dns-qsetup.sh`).
- –°–∏–≥—É—Ä–Ω–æ—Å—Ç –Ω–∞ –≤–∏—Å–æ–∫–æ –Ω–∏–≤–æ: ACL + TSIG + –≤–∞–ª–∏–¥–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞.

---
