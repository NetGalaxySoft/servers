#!/bin/bash
# =====================================================================
# vps-dns-secure.sh ‚Äì –°–∫—Ä–∏–ø—Ç –∑–∞ –ø–æ–¥—Å–∏–ª–≤–∞–Ω–µ –Ω–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ DNS (Bind9)
# –ß–∞—Å—Ç –æ—Ç NetGalaxySoft DevOps Tools
# =====================================================================

echo ""
echo -e "\e[32m=========================================="
echo -e "      DNS SECURITY HARDENING (BIND9)"
echo -e "==========================================\e[0m"
echo ""

# –û—Å–Ω–æ–≤–Ω–∏ –ø—ä—Ç–∏—â–∞ –∏ —Ñ–∞–π–ª–æ–≤–µ
NETGALAXY_DIR="/etc/netgalaxy"
MODULES_FILE="$NETGALAXY_DIR/todo.modules"
SETUP_ENV_FILE="$NETGALAXY_DIR/setup.env"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –ø—Ä–∞–≤–∞
if [[ $EUID -ne 0 ]]; then
  echo "üõë –°–∫—Ä–∏–ø—Ç—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –∏–∑–ø—ä–ª–Ω–∏ —Å root –∏–ª–∏ —á—Ä–µ–∑ sudo."
  exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ setup.env —Å—ä—â–µ—Å—Ç–≤—É–≤–∞
if [[ ! -f "$SETUP_ENV_FILE" ]]; then
  echo "‚ùå –õ–∏–ø—Å–≤–∞ —Ñ–∞–π–ª—ä—Ç $SETUP_ENV_FILE. –°—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ –ø—ä—Ä–≤–æ vps-dns-qsetup.sh."
  exit 1
fi

# =====================================================================
# [–ú–û–î–£–õ 1] –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–ù–ò –ü–†–û–í–ï–†–ö–ò
# =====================================================================
echo "[1] –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–ù–ò –ü–†–û–í–ï–†–ö–ò..."
echo "-----------------------------------------------------------"
echo ""
# TODO:
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ DNS –µ –≤–µ—á–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω (SETUP_VPS_DNS_STATUS=‚úÖ).
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ bind9 —Ä–∞–±–æ—Ç–∏.
# - –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∏ –∫–æ–ø–∏—è –Ω–∞ named.conf.options –∏ named.conf.local.
echo ""
echo ""

# =====================================================================
# [–ú–û–î–£–õ 2] –ü–†–û–í–ï–†–ö–ê –ù–ê –ë–ê–ó–û–í–ò–¢–ï –ü–û–õ–ò–¢–ò–ö–ò
# =====================================================================
echo "[2] –ü–†–û–í–ï–†–ö–ê –ù–ê –ë–ê–ó–û–í–ò–¢–ï –ü–û–õ–ò–¢–ò–ö–ò..."
echo "-----------------------------------------------------------"
echo ""
# TODO:
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ recursion no;
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ allow-query (any –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ—Å—Ç—ä–ø).
# - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ—Ä–µ–∫—Ü–∏—è –ø—Ä–∏ –Ω–µ—Å—ä–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ.
echo ""
echo ""

# =====================================================================
# [–ú–û–î–£–õ 3] –ù–ê–°–¢–†–û–ô–ö–ê –ù–ê ACL
# =====================================================================
echo "[3] –ù–ê–°–¢–†–û–ô–ö–ê –ù–ê ACL..."
echo "-----------------------------------------------------------"
echo ""
# TODO:
# - –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ ACL –±–ª–æ–∫ —Å trusted IP –∞–¥—Ä–µ—Å–∏.
# - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ named.conf.local.
echo ""
echo ""

# =====================================================================
# [–ú–û–î–£–õ 4] –ì–ï–ù–ï–†–ò–†–ê–ù–ï –ù–ê TSIG –ö–õ–Æ–ß
# =====================================================================
echo "[4] –ì–ï–ù–ï–†–ò–†–ê–ù–ï –ù–ê TSIG –ö–õ–Æ–ß..."
echo "-----------------------------------------------------------"
echo ""
# TODO:
# - –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ TSIG –∫–ª—é—á —Å tsig-keygen (hmac-sha256).
# - –ó–∞–ø–∏—Å–≤–∞–Ω–µ –≤ /etc/bind/keys/tsig.key.
# - –î–æ–±–∞–≤—è–Ω–µ –≤ named.conf.local –∏ –∑–æ–Ω–∏—Ç–µ.
echo ""
echo ""

# =====================================================================
# [–ú–û–î–£–õ 5] –ü–†–û–í–ï–†–ö–ê –ò –†–ï–°–¢–ê–†–¢
# =====================================================================
echo "[5] –ü–†–û–í–ï–†–ö–ê –ò –†–ï–°–¢–ê–†–¢..."
echo "-----------------------------------------------------------"
echo ""
# TODO:
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ —Å named-checkconf.
# - –†–µ—Å—Ç–∞—Ä—Ç –Ω–∞ bind9.
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ —É—Å–ª—É–≥–∞—Ç–∞ –µ –∞–∫—Ç–∏–≤–Ω–∞.
echo ""
echo ""

# =====================================================================
# [–ú–û–î–£–õ 6] –¢–ï–°–¢ –ù–ê TSIG
# =====================================================================
echo "[6] –¢–ï–°–¢ –ù–ê TSIG..."
echo "-----------------------------------------------------------"
echo ""
# TODO:
# - –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ dig –∑–∞ —Ç–µ—Å—Ç–æ–≤ AXFR —Å—ä—Å —Å–µ–∫—Ä–µ—Ç–µ–Ω –∫–ª—é—á.
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –≥—Ä–µ—à–∫–∏ –≤ –ª–æ–≥–æ–≤–µ—Ç–µ.
echo ""
echo ""

# =====================================================================
# [–ú–û–î–£–õ 7] –§–ò–ù–ê–õ–ï–ù –û–¢–ß–ï–¢
# =====================================================================
echo "[7] –§–ò–ù–ê–õ–ï–ù –û–¢–ß–ï–¢..."
echo "-----------------------------------------------------------"
echo ""
# TODO:
# - –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –≤—Å–∏—á–∫–∏ –º–æ–¥—É–ª–∏.
# - –ü–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.
# - –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–∏—Ç–µ —Ñ–∞–π–ª–æ–≤–µ –∏ (–ø–æ –∏–∑–±–æ—Ä) —Å–∫—Ä–∏–ø—Ç–∞.
echo ""
echo ""

echo "‚úÖ –®–∞–±–ª–æ–Ω—ä—Ç –Ω–∞ —Å–∫—Ä–∏–ø—Ç–∞ –µ –≥–æ—Ç–æ–≤. –ü–æ–ø—ä–ª–Ω–µ—Ç–µ –º–æ–¥—É–ª–∏—Ç–µ —Å —Ä–µ–∞–ª–Ω–∞ –ª–æ–≥–∏–∫–∞."
